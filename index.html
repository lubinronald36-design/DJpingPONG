<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Audio Experience â€” Updated</title>
<style>
    body {
        background: linear-gradient(135deg, #000, #2b2b2b);
        color: #fff;
        font-family: Arial, sans-serif;
        text-align: center;
        padding-top: 50px;
    }

    h1 {
        font-size: 32px;
        margin-bottom: 30px;
        text-transform: uppercase;
        letter-spacing: 3px;
    }

    .btn {
        display: block;
        width: 250px;
        margin: 15px auto;
        padding: 15px;
        font-size: 20px;
        font-weight: bold;
        color: white;
        background: #444;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.3s;
    }

    .btn:hover {
        background: #777;
        transform: scale(1.05);
    }

    .note { font-size: 12px; opacity: 0.8; margin-top: 6px; }
</style>
</head>
<body>

<h1>ðŸŽ§ Audio Control</h1>

<!-- MAIN BACKGROUND MUSIC -->
<audio id="music" src="cue.mp3" loop></audio>
<button class="btn" id="playMusic">â–¶ Play / Pause Music</button>

<!-- UPDATED BUTTONS -->
<button class="btn voice" data-voice="elp.mp3" data-extra="cue2.mp3">ðŸŽ¤ Voice 1</button>
<button class="btn voice" data-voice="ronald.mp3" data-extra="voice3.mp3">ðŸŽ¤ Voice 2</button>

<p class="note">Files required: cue.mp3, elp.mp3, ronald.mp3, cue2.mp3, voice3.mp3</p>

<script>
/* ------- AUDIO SETTINGS ------- */
const fadeIntervalMs = 40;
const fadeStep = 0.12;
const duckVolume = 0.15;
const normalVolume = 1.0;

/* ------- ELEMENTS ------- */
const music = document.getElementById('music');
const playMusicBtn = document.getElementById('playMusic');

playMusicBtn.addEventListener('click', () => {
    if (music.paused) {
        music.volume = normalVolume;
        music.play().catch(()=>{});
    } else {
        music.pause();
    }
});

/* Smooth fade */
function fadeTo(audio, target, callback) {
    target = Math.max(0, Math.min(1, target));
    const step = audio.volume > target ? -fadeStep : fadeStep;

    const timer = setInterval(() => {
        audio.volume = Math.max(0, Math.min(1, audio.volume + step));
        if ((step < 0 && audio.volume <= target) || (step > 0 && audio.volume >= target)) {
            audio.volume = target;
            clearInterval(timer);
            if (callback) callback();
        }
    }, fadeIntervalMs);
}

let activeGroups = [];

document.querySelectorAll('.voice').forEach(btn => {
    btn.addEventListener('click', async () => {

        // prevent button spam (optional safety)
        if (activeGroups.some(g => !g.finished)) return;

        if (music.paused) {
            try { await music.play(); } catch(e){}
        }

        const voice = new Audio(btn.dataset.voice);
        const extra = new Audio(btn.dataset.extra);

        voice.volume = 1.0;
        extra.volume = 1.0;

        let group = { finished:false };
        activeGroups.push(group);

        let finishedCount = 0;
        const checkDone = () => {
            finishedCount++;
            if (finishedCount === 2) {
                group.finished = true;
                activeGroups = activeGroups.filter(g=>!g.finished);

                if (activeGroups.length === 0) fadeTo(music, normalVolume);
            }
        };

        voice.onended = checkDone;
        extra.onended = checkDone;

        fadeTo(music, duckVolume);
        voice.play().catch(()=>{});
        extra.play().catch(()=>{});
    });
});
</script>
</body>
</html>
